const {
  CancellationToken
} = require('../../../../base/common/cancellation.js');
const {
  assertType
} = require('../../../../base/common/types.js');
const {
  URI
} = require('../../../../base/common/uri.js');
const {
  ITextModelService
} = require('../../../common/services/resolverService.js');
const {
  IOutlineModelService
} = require('./outlineModel.js');
const {
  CommandsRegistry
} = require('../../../../platform/commands/common/commands.js');
CommandsRegistry.registerCommand('_executeDocumentSymbolProvider', async function (accessor, ...args) {
  const [resource] = args;
  assertType(URI.isUri(resource));
  const outlineService = accessor.get(IOutlineModelService);
  const modelService = accessor.get(ITextModelService);
  const reference = await modelService.createModelReference(resource);
  try {
    return (await outlineService.getOrCreate(reference.object.textEditorModel, CancellationToken.None)).getTopLevelSymbols();
  } finally {
    reference.dispose();
  }
});